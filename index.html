<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <meta http-equiv="refresh" content="20"> -->
  <!-- Youbike icon -->
  <link rel="shortcut icon" href="https://www.youbike.com.tw/region/favicon.ico">
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
  <!-- cdnjs/ boostrap, axios, iconify -->
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css' />
  <scrip src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.min.js' />
  <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.5/axios.min.js'></script>
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <title>Youbike</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Noto Sans', sans-serif;
    }

    #top-bar {
      z-index: 99999;
    }

    #content {
      margin: 66px;
      padding: 40px 0;
    }

    #content .card {
      margin-bottom: 1rem;
    }

    #content .card:hover {
      transform: scale(1.1);
      box-shadow: 0 0 5px #ccc;
      transition: 0.5s;
      z-index: 999
    }

    #footer iconify-icon {
      font-size: 24px;
    }
  </style>
</head>

<body>
  <!-- 導覽列 -->
  <nav id="top-bar" class="navbar navbar-expand-lg navbar-light bg-light position-fixed fixed-top w-100"
    style="z-index: 99999;background: #000;">
    <div class="container justify-content-center justify-content-sm-between">
      <a class="navbar-brand" href="#">
        <img id="logo" src="https://www.youbike.com.tw/region/assets/images/logo.svg" width="120px" alt="">
      </a>
      <form>
        <input id="search-input" class="form-control me-2" type="text" placeholder="Search" aria-label="Search">
      </form>
    </div>
  </nav>
  <!-- 內容區 -->
  <div id="content">
    <div class="container">
      <div class="row align-items-center">

      </div>
    </div>
  </div>

  <!-- 頁尾 -->
  <div id="footer" class="position-fixed fixed-bottom bg-light">
    <div class="container ">
      <footer class="d-flex flex-column-reverse flex-md-row justify-content-around align-items-center py-2 my-3">
        <div class="col-md-4 d-flex align-items-center">
          <span class="text-muted">©2024 copyright by Xuan</span>
        </div>

        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
          <li class="ms-3">
            <a href="https://github.com/xuanlin129" target="_blank">
              <iconify-icon icon="mdi:github" style="color: #aaa;"></iconify-icon>
            </a>
          </li>
          <li class="ms-3">
            <a href="https://xuanlin129.github.io/" target="_blank">
              <iconify-icon icon="mdi:web" style="color: #aaa;"></iconify-icon>
            </a>
          </li>
          <li class="ms-3">
            <a href="https://github.com/xuanlin129"></a>
          </li>
        </ul>
      </footer>
    </div>
  </div>

  <script>
    const search = document.querySelector('#search-input')
    const dataBase = document.querySelector('#content').firstElementChild.firstElementChild;

    (async () => {
      try {
        const { data } = await axios.get('https://tcgbusfs.blob.core.windows.net/dotapp/youbike/v2/youbike_immediate.json')
        for (const info of data) {
          // 顏色
          let color = ''
          if (info.sbi / info.tot === 0) {
            color = 'grey'
          } else if (info.sbi / info.tot <= 0.3) {
            color = '#F5303E'
          } else if (info.sbi / info.tot <= 0.7) {
            color = '#FF9D19'
          } else {
            color = '#B9BF0D'
          }
          const stat = info.sna.split('_').at(-1)
          dataBase.insertAdjacentHTML('beforeend', `
              <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                <div class="card" style="height: 200px;border: 5px solid ${color}">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center fw-bold">${stat}</h5>
                    <ul class="mt-auto">
                      <li>剩餘: ${info.sbi} 台</li>
                      <li>區域: ${info.sarea}</li>
                      <li>經度: ${info.lng}</li>
                      <li>緯度: ${info.lat}</li>
                    </ul>
                  </div>
                </div>
              </div>
              `)
        }
      } catch (error) {
        console.log(error)
      }
    })()

    search.addEventListener('input', event => {
      // console.log(event.target.value);
      dataBase.innerHTML = '';
      (async () => {
        try {
          const { data } = await axios.get('https://tcgbusfs.blob.core.windows.net/dotapp/youbike/v2/youbike_immediate.json')
          for (const info of data) {
            // 顏色
            color = ''
            if (info.sbi / info.tot === 0) {
              color = 'grey'
            } else if (info.sbi / info.tot <= 0.3) {
              color = '#F5303E'
            } else if (info.sbi / info.tot <= 0.7) {
              color = '#FF9D19'
            } else {
              color = '#B9BF0D'
            }
            const stat = info.sna.split('_').at(-1)
            if (stat.includes(`${event.target.value}`) || info.sarea.includes(`${event.target.value}`)) {
              dataBase.insertAdjacentHTML('beforeend', `
              <div class="col-12 col-sm-6 col-lg-3">
                <div class="card" style="height: 200px;border: 5px solid ${color}">
                  <div class="card-body">
                    <h5 class="card-title text-center fw-bold">${stat}</h5>
                    <ul class="mt-auto">
                      <li>剩餘: ${info.sbi} 台</li>
                      <li>區域: ${info.sarea}</li>
                      <li>經度: ${info.lng}</li>
                      <li>緯度: ${info.lat}</li>
                    </ul>
                  </div>
                </div>
              </div>
              `)
            }
          }
        } catch (error) {
          console.log(error)
        }
      })()
    })

    // 防止搜尋造成網頁跳轉
    search.addEventListener('submit', event => {
      event.preventDefault()
    })

    // setInterval('window.location.reload();', 10000).preventDefault()
  </script>
</body>

</html>
